{"version":3,"file":"index.module.js","sources":["../src/index.ts"],"sourcesContent":["import { readFileSync, writeFileSync } from 'fs';\nimport * as path from 'path';\nimport { exec } from 'child_process';\n\nconst execPromise = (command) => {\n  return new Promise((resolve, reject) => {\n    exec(command, (error, stdout, stderr) => {\n      if (error) {\n        reject({ error, stderr, stdout });\n      } else {\n        resolve(stdout);\n      }\n    });\n  });\n};\n\nexport const meteorPackageTypesGenerator = {\n  run: async ({\n    tsInput,\n    declarationInput,\n    declarationOutput,\n    prefix,\n    tscCliParams = '--emitDeclarationOnly --declaration --declarationMap',\n  }) => {\n    try {\n      await execPromise(\n        `npx tsc ${tsInput.join(\n          ' '\n        )} --outFile ${declarationInput} ${tscCliParams}`\n      );\n    } catch (error) {\n      console.log(error?.stderr);\n      console.log(error?.stdout);\n      console.error(error?.error);\n    }\n\n    // Read the contents of the generated .d.ts file\n    const fileContent = readFileSync(declarationInput, 'utf-8');\n\n    // Add prefix to each module declaration\n    const updatedContent = fileContent\n      .replace(/declare module [\"'](.+?)[\"']/g, (match, p1) => {\n        return `declare module \"${prefix}${p1}\"`;\n      })\n      .replace(/\\/index/g, '');\n\n    // Write the updated content to a new file or overwrite the existing file\n    writeFileSync(declarationOutput, updatedContent, 'utf-8');\n\n    console.log(\n      `Prefixes added to modules and written to ${declarationOutput}`\n    );\n  },\n};\n"],"names":["execPromise","command","Promise","resolve","reject","exec","error","stdout","stderr","meteorPackageTypesGenerator","run","tsInput","declarationInput","declarationOutput","prefix","tscCliParams","join","console","log","fileContent","readFileSync","updatedContent","replace","match","p1","writeFileSync"],"mappings":";;;AAIA,MAAMA,WAAW,GAAIC,OAAO,IAAI;AAC9B,EAAA,OAAO,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAI;IACrCC,IAAI,CAACJ,OAAO,EAAE,CAACK,KAAK,EAAEC,MAAM,EAAEC,MAAM,KAAI;AACtC,MAAA,IAAIF,KAAK,EAAE;AACTF,QAAAA,MAAM,CAAC;UAAEE,KAAK;UAAEE,MAAM;AAAED,UAAAA,MAAAA;AAAQ,SAAA,CAAC,CAAA;AAClC,OAAA,MAAM;QACLJ,OAAO,CAACI,MAAM,CAAC,CAAA;AAChB,OAAA;AACH,KAAC,CAAC,CAAA;AACJ,GAAC,CAAC,CAAA;AACJ,CAAC,CAAA;AAEM,MAAME,2BAA2B,GAAG;EACzCC,GAAG,EAAE,OAAO;IACVC,OAAO;IACPC,gBAAgB;IAChBC,iBAAiB;IACjBC,MAAM;AACNC,IAAAA,YAAY,GAAG,sDAAA;AAAsD,GACtE,KAAI;IACH,IAAI;AACF,MAAA,MAAMf,WAAW,CACf,CAAWW,QAAAA,EAAAA,OAAO,CAACK,IAAI,CACrB,GAAG,CACJ,CAAcJ,WAAAA,EAAAA,gBAAgB,CAAIG,CAAAA,EAAAA,YAAY,EAAE,CAClD,CAAA;KACF,CAAC,OAAOT,KAAK,EAAE;MACdW,OAAO,CAACC,GAAG,CAACZ,KAAK,oBAALA,KAAK,CAAEE,MAAM,CAAC,CAAA;MAC1BS,OAAO,CAACC,GAAG,CAACZ,KAAK,oBAALA,KAAK,CAAEC,MAAM,CAAC,CAAA;MAC1BU,OAAO,CAACX,KAAK,CAACA,KAAK,oBAALA,KAAK,CAAEA,KAAK,CAAC,CAAA;AAC5B,KAAA;AAED;AACA,IAAA,MAAMa,WAAW,GAAGC,YAAY,CAACR,gBAAgB,EAAE,OAAO,CAAC,CAAA;AAE3D;AACA,IAAA,MAAMS,cAAc,GAAGF,WAAW,CAC/BG,OAAO,CAAC,+BAA+B,EAAE,CAACC,KAAK,EAAEC,EAAE,KAAI;AACtD,MAAA,OAAO,CAAmBV,gBAAAA,EAAAA,MAAM,CAAGU,EAAAA,EAAE,CAAG,CAAA,CAAA,CAAA;AAC1C,KAAC,CAAC,CACDF,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC,CAAA;AAE1B;AACAG,IAAAA,aAAa,CAACZ,iBAAiB,EAAEQ,cAAc,EAAE,OAAO,CAAC,CAAA;AAEzDJ,IAAAA,OAAO,CAACC,GAAG,CACT,CAA4CL,yCAAAA,EAAAA,iBAAiB,EAAE,CAChE,CAAA;AACH,GAAA;;;;;"}